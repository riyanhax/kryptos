<html>
<head>
<meta id='metaFileNameId' name='id' content='51520' />
<title>Tutorial 4: Custom Nodes Integration</title>
<link type='text/css' href='xstyle.css' rel='stylesheet' media='all' />
<script src='script.js' language='javascript' type='text/javascript'> </script>
<script src='common.js' language='javascript' type='text/javascript'> </script>
<xml>
<MSHelp:Attr Name="Product" Value="JsDiagram">
</xml>
</head>
<body style='margin: 0;'>
<img src='collapse.png' title='Collapse Section' id='collapseImage' style='display: none; height: 0; width: 0;' /><img src='expand.png' title='Expand Section' id='expandImage' style='display: none; height: 0; width: 0;' /><img src='collapsesmall.png' title='Collapse All' id='collapseAllImage' style='display: none; height: 0; width: 0;' /><img src='expandsmall.png' title='Expand All' id='expandAllImage' style='display: none; height: 0; width: 0;' /><input type="hidden" id="userDataCache" class="userDataStyle"><img src='arrow.png' title='DropDown image' id='dropDownImage' style='display: none; height: 0; width: 0;' /><img src='arrowh.png' title='DropDown image' id='dropDownHoverImage' style='display: none; height: 0; width: 0;' /><img src='copycode.png' title='Copy Code' id='copyCodeImage' style='display: none; height: 0; width: 0;' /><img src='copycodeh.png' title='Copy Code' id='copyCodeHoverImage' style='display: none; height: 0; width: 0;' /><div id='nsbanner'>
<table class='bannerparthead' cellspacing='0'>
<tr>
<td><span class='gtitle'>MindFusion.Diagramming for JavaScript Programmer's Guide</span></td>
</tr>
<tr>
<td style='border-bottom: solid 1px #C8CDDE;'><span class='title'>Tutorial 4: Custom Nodes Integration</span></td>
</tr>
</table>
</div>
<div id='nstext'>
<p>This tutorial builds upon the OrgChartNode type from <a id='51519' href='Tutorial_3_0.htm' title=''>Tutorial 3</a>. It shows how to fully integrate the custom type with other <span>MindFusion.Diagramming for JavaScript</span>&#160;features, such as clipboard support, undo support, creating nodes by drag-and-drop or drawing with the mouse on the canvas.</p><p>1. Create copies of&#160;<span class='repeatingLink'>Tutorial 3</span> files - Tutorail3.html and Tutorial3.js and name them Tuturial4.html and Tutorial4.js respectively.</p><p>2.&#160;Add a DIV and CANVAS elements to Tutorial4.html that will represent a <a id='32519' href='T_MindFusion_Diagramming_NodeListView.htm' title=''>NodeListView</a> control:</p><p><table class='syntax' cellspacing='0'><tr><th><span style='float: left;'>HTML</span>
<span class='copyCode' onclick='CopyCode(this);' onkeypress='CopyCode_CheckKey(this);' onmouseover='ChangeCopyCodeIcon(this, true);' onmouseout='ChangeCopyCodeIcon(this, false);'>
<img src='copycode.png' title='Copy Code' style='border-width: 0;' />&#160;Copy Code</span>
</th></tr><tr><td><p><span class="codeComment">&lt;!-- The NodeListView component is bound to the canvas element below --&gt;</span><br/><span class="codeXamlDelimiter">&lt;</span><span class="codeXamlTag">div</span> <span class="codeXamlAttributeName">style</span><span class="codeXamlDelimiter">=</span><span class="codeXamlAttributeValue">"width: 250px; height: 500px; overflow: auto; border: 1px solid black;"</span><span class="codeXamlDelimiter">&gt;</span><br/><br/><span class="codeXamlDelimiter">&lt;</span><span class="codeXamlTag">canvas</span> <span class="codeXamlAttributeName">id</span><span class="codeXamlDelimiter">=</span><span class="codeXamlAttributeValue">"nodeListView"</span> <span class="codeXamlAttributeName">width</span><span class="codeXamlDelimiter">=</span><span class="codeXamlAttributeValue">"62"</span> <span class="codeXamlAttributeName">height</span><span class="codeXamlDelimiter">=</span><span class="codeXamlAttributeValue">"70"</span><span class="codeXamlDelimiter">&gt;</span><br/>&#160;&#160;&#160; <span class="codeXamlAttributeName">This</span> <span class="codeXamlAttributeName">page</span> <span class="codeXamlAttributeName">requires</span> <span class="codeXamlAttributeName">a</span> <span class="codeXamlAttributeName">browser</span> <span class="codeXamlAttributeName">that</span> <span class="codeXamlAttributeName">supports</span> <span class="codeXamlAttributeName">HTML</span> 5 <span class="codeXamlAttributeName">Canvas</span> <span class="codeXamlAttributeName">element</span>.<br/><span class="codeXamlDelimiter">&lt;/</span><span class="codeXamlTag">canvas</span><span class="codeXamlDelimiter">&gt;</span><br/><br/><span class="codeXamlDelimiter">&lt;/</span><span class="codeXamlTag">div</span><span class="codeXamlDelimiter">&gt;</span></p></td></tr></table></p><p>3. Add five buttons to the page -&#160;copy, cut, paste, undo and redo - and define click handlers that will be used to call the corresponding diagram methods.</p><p><table class='syntax' cellspacing='0'><tr><th><span style='float: left;'>HTML</span>
<span class='copyCode' onclick='CopyCode(this);' onkeypress='CopyCode_CheckKey(this);' onmouseover='ChangeCopyCodeIcon(this, true);' onmouseout='ChangeCopyCodeIcon(this, false);'>
<img src='copycode.png' title='Copy Code' style='border-width: 0;' />&#160;Copy Code</span>
</th></tr><tr><td><p><span class="codeXamlDelimiter">&lt;</span><span class="codeXamlTag">button</span> <span class="codeXamlAttributeName">onclick</span><span class="codeXamlDelimiter">=</span><span class="codeXamlAttributeValue">"diagram.copyToClipboard()"</span><span class="codeXamlDelimiter">&gt;</span><span class="codeXamlAttributeName">copy</span><span class="codeXamlDelimiter">&lt;/</span><span class="codeXamlTag">button</span><span class="codeXamlDelimiter">&gt;</span><br/><span class="codeXamlDelimiter">&lt;</span><span class="codeXamlTag">button</span> <span class="codeXamlAttributeName">onclick</span><span class="codeXamlDelimiter">=</span><span class="codeXamlAttributeValue">"diagram.cutToClipboard()"</span><span class="codeXamlDelimiter">&gt;</span><span class="codeXamlAttributeName">cut</span><span class="codeXamlDelimiter">&lt;/</span><span class="codeXamlTag">button</span><span class="codeXamlDelimiter">&gt;</span><br/><span class="codeXamlDelimiter">&lt;</span><span class="codeXamlTag">button</span> <span class="codeXamlAttributeName">onclick</span><span class="codeXamlDelimiter">=</span><span class="codeXamlAttributeValue">"diagram.pasteFromClipboard(5, 5)"</span><span class="codeXamlDelimiter">&gt;</span><span class="codeXamlAttributeName">paste</span><span class="codeXamlDelimiter">&lt;/</span><span class="codeXamlTag">button</span><span class="codeXamlDelimiter">&gt;</span><br/><span class="codeXamlDelimiter">&lt;</span><span class="codeXamlTag">button</span> <span class="codeXamlAttributeName">onclick</span><span class="codeXamlDelimiter">=</span><span class="codeXamlAttributeValue">"diagram.undo()"</span><span class="codeXamlDelimiter">&gt;</span><span class="codeXamlAttributeName">undo</span><span class="codeXamlDelimiter">&lt;/</span><span class="codeXamlTag">button</span><span class="codeXamlDelimiter">&gt;</span><br/><span class="codeXamlDelimiter">&lt;</span><span class="codeXamlTag">button</span> <span class="codeXamlAttributeName">onclick</span><span class="codeXamlDelimiter">=</span><span class="codeXamlAttributeValue">"diagram.redo()"</span><span class="codeXamlDelimiter">&gt;</span><span class="codeXamlAttributeName">redo</span><span class="codeXamlDelimiter">&lt;/</span><span class="codeXamlTag">button</span><span class="codeXamlDelimiter">&gt;</span></p></td></tr></table></p><p>4. Add shortcuts to the <span class='repeatingLink'>NodeListView</span> and <a id='32805' href='T_MindFusion_Drawing_Size.htm' title=''>Size</a> classes in Tutorial4.js and define a nodeListView variable.</p><p><table class='syntax' codeLanguage='JavaScript' cellspacing='0'><tr><th><span style='float: left;'>JavaScript</span>
<span class='copyCode' onclick='CopyCode(this);' onkeypress='CopyCode_CheckKey(this);' onmouseover='ChangeCopyCodeIcon(this, true);' onmouseout='ChangeCopyCodeIcon(this, false);'>
<img src='copycode.png' title='Copy Code' style='border-width: 0;' />&#160;Copy Code</span>
</th></tr><tr><td><p><span class="codeKeyword">var</span> NodeListView = MindFusion.Diagramming.NodeListView;<br/><br/><span class="codeKeyword">var</span> Size = MindFusion.Drawing.Size;<br/><br/><span class="codeKeyword">var</span> nodeListView = <span class="codeKeyword">null</span>;</p></td></tr></table></p><p>5. Classes generated by calling <a id='57997' href='M_MindFusion_Diagramming_CompositeNode_classFromTemplate_2_String_Object.htm' title=''>classFromTemplate</a> implement undo/redo, clipboard and&#160;serialization support for&#160;their auto-properties out of the box. When creating more complex types with their own data properties, you'd need to implement serialization&#160;and cloning&#160;for them yourself.&#160;Lets show how to implement the various operations by creating a new class that adds a custom property. Start by renaming the class from tutorial 3 to TemplatedBase, and creating a new OrgChartNode class that derives from it.</p><p><table class='syntax' codeLanguage='JavaScript' cellspacing='0'><tr><th><span style='float: left;'>JavaScript</span>
<span class='copyCode' onclick='CopyCode(this);' onkeypress='CopyCode_CheckKey(this);' onmouseover='ChangeCopyCodeIcon(this, true);' onmouseout='ChangeCopyCodeIcon(this, false);'>
<img src='copycode.png' title='Copy Code' style='border-width: 0;' />&#160;Copy Code</span>
</th></tr><tr><td><p><span class="codeKeyword">var</span> TemplatedBase = CompositeNode.classFromTemplate(<span class="codeString">"TemplatedBase"</span>,<br/>&#160;&#160;&#160; <span class="codeComment">// ...</span><br/><br/><span class="codeKeyword">var</span> OrgChartNode = <span class="codeKeyword">function</span> (parent)<br/>{<br/>&#160;&#160;&#160; AbstractionLayer.initializeBase(OrgChartNode, <span class="codeKeyword">this</span>, [parent]);<br/>&#160;&#160;&#160; <span class="codeKeyword">this</span>.cost = <span class="codeString">"low"</span>;<br/>};</p><p>OrgChartNode.prototype =<br/>{<br/>&#160;&#160;&#160; getCost: <span class="codeKeyword">function</span> ()<br/>&#160;&#160;&#160; {<br/>&#160;&#160;&#160; &#160;&#160;&#160; <span class="codeKeyword">return</span> <span class="codeKeyword">this</span>.cost;<br/>&#160;&#160;&#160; },<br/><br/>&#160;&#160;&#160; setCost: <span class="codeKeyword">function</span> (value)<br/>&#160;&#160;&#160; {<br/>&#160;&#160;&#160; &#160;&#160;&#160; <span class="codeKeyword">this</span>.cost = value;<br/>&#160;&#160;&#160; }<br/>}<br/><br/>AbstractionLayer.registerClass(<br/>&#160;&#160;&#160; OrgChartNode, <span class="codeString">"OrgChartNode"</span>, TemplatedBase);</p></td></tr></table></p><p>6.&#160;Add a clone method override to the OrgChartNode prototype.</p><p><table class='syntax' codeLanguage='JavaScript' cellspacing='0'><tr><th><span style='float: left;'>JavaScript</span>
<span class='copyCode' onclick='CopyCode(this);' onkeypress='CopyCode_CheckKey(this);' onmouseover='ChangeCopyCodeIcon(this, true);' onmouseout='ChangeCopyCodeIcon(this, false);'>
<img src='copycode.png' title='Copy Code' style='border-width: 0;' />&#160;Copy Code</span>
</th></tr><tr><td><p><span class="codeComment">// support for the NodeListView drag'n'drop</span><br/>clone: <span class="codeKeyword">function</span> ()<br/>{<br/>&#160;&#160;&#160; <span class="codeKeyword">var</span> copy = AbstractionLayer.callBaseMethod(<br/>&#160;&#160;&#160; &#160;&#160;&#160; OrgChartNode, <span class="codeKeyword">this</span>, <span class="codeString">"clone"</span>, []);<br/>&#160;&#160;&#160; copy.cost = <span class="codeKeyword">this</span>.cost;<br/>&#160;&#160;&#160; <span class="codeKeyword">return</span> copy;<br/>},</p></td></tr></table></p><p>7. To implement&#160;clipboard support&#160;of any new properties added by a custom item class,&#160;add&#160;<b>fromJson</b> and <b>toJson</b>&#160;method overrides to the prototype definition:</p><p><table class='syntax' codeLanguage='JavaScript' cellspacing='0'><tr><th><span style='float: left;'>JavaScript</span>
<span class='copyCode' onclick='CopyCode(this);' onkeypress='CopyCode_CheckKey(this);' onmouseover='ChangeCopyCodeIcon(this, true);' onmouseout='ChangeCopyCodeIcon(this, false);'>
<img src='copycode.png' title='Copy Code' style='border-width: 0;' />&#160;Copy Code</span>
</th></tr><tr><td><p><span class="codeComment">// clipboard and serialization support</span><br/>toJson: <span class="codeKeyword">function</span> ()<br/>{<br/>&#160;&#160;&#160; <span class="codeKeyword">var</span> json = AbstractionLayer.callBaseMethod(<br/>&#160;&#160;&#160; &#160;&#160;&#160; OrgChartNode, <span class="codeKeyword">this</span>, <span class="codeString">"toJson"</span>, []);<br/>&#160;&#160;&#160; json.cost = <span class="codeKeyword">this</span>.cost;<br/>&#160;&#160;&#160; <span class="codeKeyword">return</span> json;<br/>},<br/><br/>fromJson: <span class="codeKeyword">function</span> (json)<br/>{<br/>&#160;&#160;&#160; AbstractionLayer.callBaseMethod(<br/>&#160;&#160;&#160; &#160;&#160;&#160; OrgChartNode, <span class="codeKeyword">this</span>, <span class="codeString">"fromJson"</span>, [json]);<br/>&#160;&#160;&#160; <span class="codeKeyword">this</span>.cost = json.cost;<br/>},</p></td></tr></table></p><p>8. In order to enable undo / redo of changes done on OrgChartNode, add&#160;saveState and&#160;restoreState method overrides to the prototype definition:</p><p><table class='syntax' codeLanguage='JavaScript' cellspacing='0'><tr><th><span style='float: left;'>JavaScript</span>
<span class='copyCode' onclick='CopyCode(this);' onkeypress='CopyCode_CheckKey(this);' onmouseover='ChangeCopyCodeIcon(this, true);' onmouseout='ChangeCopyCodeIcon(this, false);'>
<img src='copycode.png' title='Copy Code' style='border-width: 0;' />&#160;Copy Code</span>
</th></tr><tr><td><p><span class="codeComment">// undo/redo</span><br/>saveState: <span class="codeKeyword">function</span> ()<br/>{<br/>&#160;&#160;&#160; <span class="codeKeyword">var</span> state = AbstractionLayer.callBaseMethod(<br/>&#160;&#160;&#160; &#160;&#160;&#160; OrgChartNode, <span class="codeKeyword">this</span>, <span class="codeString">"saveState"</span>, []);<br/>&#160;&#160;&#160; state.cost = <span class="codeKeyword">this</span>.cost;<br/>&#160;&#160;&#160; <span class="codeKeyword">return</span> state;<br/>},<br/><br/>restoreState: <span class="codeKeyword">function</span> (state)<br/>{<br/>&#160;&#160;&#160; AbstractionLayer.callBaseMethod(<br/>&#160;&#160;&#160; &#160;&#160;&#160; OrgChartNode, <span class="codeKeyword">this</span>, <span class="codeString">"restoreState"</span>, [state]);<br/>&#160;&#160;&#160; <span class="codeKeyword">this</span>.cost = state.cost;<br/>}</p></td></tr></table></p><p>9. In order to enable drawing OrgChartNodes with the mouse, add the following code to the&#160;document.ready handler:</p><p><table class='syntax' codeLanguage='JavaScript' cellspacing='0'><tr><th><span style='float: left;'>JavaScript</span>
<span class='copyCode' onclick='CopyCode(this);' onkeypress='CopyCode_CheckKey(this);' onmouseover='ChangeCopyCodeIcon(this, true);' onmouseout='ChangeCopyCodeIcon(this, false);'>
<img src='copycode.png' title='Copy Code' style='border-width: 0;' />&#160;Copy Code</span>
</th></tr><tr><td><p><span class="codeComment">// enable drawing of custom nodes interactively</span><br/>diagram.setCustomNodeType(OrgChartNode);<br/>diagram.setBehavior(Behavior.Custom);</p></td></tr></table></p><p>10. To enable undo / redo support on the <a id='32377' href='CC_T_MindFusion_Diagramming_Diagram_0.htm' title=''>Diagram</a> object, set its undoEnabled property to <b>true</b> in the document.ready handler.</p><p><table class='syntax' codeLanguage='JavaScript' cellspacing='0'><tr><th><span style='float: left;'>JavaScript</span>
<span class='copyCode' onclick='CopyCode(this);' onkeypress='CopyCode_CheckKey(this);' onmouseover='ChangeCopyCodeIcon(this, true);' onmouseout='ChangeCopyCodeIcon(this, false);'>
<img src='copycode.png' title='Copy Code' style='border-width: 0;' />&#160;Copy Code</span>
</th></tr><tr><td><span class="codeComment">// enable undo/redo support</span><br/>diagram.setUndoEnabled(<span class="codeKeyword">true</span>);</td></tr></table></p><p>11. Finally, add initialization code for the&#160; <span class='repeatingLink'>NodeListView</span> to the load hadler.</p><p><table class='syntax' codeLanguage='JavaScript' cellspacing='0'><tr><th><span style='float: left;'>JavaScript</span>
<span class='copyCode' onclick='CopyCode(this);' onkeypress='CopyCode_CheckKey(this);' onmouseover='ChangeCopyCodeIcon(this, true);' onmouseout='ChangeCopyCodeIcon(this, false);'>
<img src='copycode.png' title='Copy Code' style='border-width: 0;' />&#160;Copy Code</span>
</th></tr><tr><td><p><span class="codeComment">// create a NodeListView component that wraps the "nodeListView" canvas</span><br/>nodeListView = NodeListView.create($(<span class="codeString">"#nodeListView"</span>)[<span class="codeNumber">0</span>]);<br/>nodeListView.setMeasureUnit(<span class="codeNumber">6</span>);<br/>nodeListView.setPadding(<span class="codeNumber">1</span>);<br/>nodeListView.setIconSize(<span class="codeKeyword">new</span> Size(<span class="codeNumber">65</span>, <span class="codeNumber">25</span>));<br/>nodeListView.setDefaultNodeSize(<span class="codeKeyword">new</span> Size(<span class="codeNumber">65</span>, <span class="codeNumber">25</span>));<br/><br/><span class="codeComment">// create and add some nodes to the node list</span><br/><span class="codeKeyword">var</span> node1 = <span class="codeKeyword">new</span> OrgChartNode(nodeListView);<br/>node1.setTitle(<span class="codeString">"Skiing"</span>);<br/>node1.setFullName(<span class="codeString">"Winter"</span>);<br/>node1.setDetails(<br/>&#160;<span class="codeString">"Vacation in the snow. \r\n"</span> +<br/>&#160;<span class="codeString">"Ski lessons, ski equipment and winter sports."</span>);<br/>node1.setImage(<span class="codeString">"snowman.png"</span>);<br/>node1.setCost(<span class="codeString">"high"</span>);<br/>nodeListView.addNode(node1, <span class="codeString">""</span>);<br/><br/><span class="codeKeyword">var</span> node2 = <span class="codeKeyword">new</span> OrgChartNode(nodeListView);<br/>node2.setTitle(<span class="codeString">"Seaside"</span>);<br/>node2.setFullName(<span class="codeString">"Summer"</span>);<br/>node2.setDetails(<span class="codeString">"Sun bathing, swimming, catching tan."</span>);<br/>node2.setImage(<span class="codeString">"seaside.png"</span>);<br/>node2.setCost(<span class="codeString">"high"</span>);<br/>nodeListView.addNode(node2, <span class="codeString">""</span>);</p></td></tr></table></p><p>12. Publish JQuery.js, MindFusion.Diagramming.js and the tutorial files using web server of your choice. Open Tutorial4.html in a web browser and you should be able to create nodes by drag and drop from NodeListView, copy and paste them, and redo/undo operations done on them.</p>
</div>
<div id='nsfooter'>
<table class='footer' cellspacing='0'>
<tr>
<td valign='middle'>
<span class='copyright'>© 2017 MindFusion</span>
</td>
</tr>
</table>
</div>
</body>
</html>
